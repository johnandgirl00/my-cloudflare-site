# μ•”νΈν™”ν WebM μ°¨νΈ μ„λΉ„μ¤

μ»¤λ®¤λ‹ν‹° μ„λ² λ”©μ„ μ„ν• μ•”νΈν™”ν μ°¨νΈ μ„λΉ„μ¤μ…λ‹λ‹¤. Bitcoin κ°€κ²© μ°¨νΈλ¥Ό μ• λ‹λ©”μ΄μ… SVGλ΅ μƒμ„±ν•μ—¬ μ•”νΈν™”ν μ»¤λ®¤λ‹ν‹° μ‚¬μ΄νΈ μƒλ‹¨ 1/3 μμ—­μ— μ„λ² λ“ν•  μ μμµλ‹λ‹¤.

## π€ λ°°ν¬λ μ„λΉ„μ¤

**λ©”μΈ URL**: https://my-cloudflare-site.johnandgirl.workers.dev

## π“‹ ν”„λ΅μ νΈ κ°μ”

μ΄ μ„λΉ„μ¤λ” λ‹¤μκ³Ό κ°™μ€ κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤:

- π”„ CoinGecko APIλ¥Ό ν†µν• μλ™ κ°€κ²© λ°μ΄ν„° μμ§‘ (λ§¤μ‹κ°„)
- π“ Cloudflare D1 λ°μ΄ν„°λ² μ΄μ¤μ— κ°€κ²© λ°μ΄ν„° μ €μ¥
- π¬ μ• λ‹λ©”μ΄μ… SVG μ°¨νΈ μƒμ„± λ° R2 λ²„ν‚· μ €μ¥
- π μ»¤λ®¤λ‹ν‹° μ‚¬μ΄νΈ μ„λ² λ”©μ„ μ„ν• API μ κ³µ
- π“ μ‹¤μ‹κ°„ κ°€κ²© νΈλ λ“ ν‘μ‹

## β… μ™„λ£λ κΈ°λ¥

### μΈν”„λΌ λ° λ°μ΄ν„° μμ§‘
- [x] Cloudflare Workers μ•„ν‚¤ν…μ² κµ¬μ¶• (D1 + R2)
- [x] CoinGecko API μ—°λ™ λ° μλ™ λ°μ΄ν„° μμ§‘
- [x] μ‹κ°„λ³„ ν¬λ΅  μ‘μ—…μΌλ΅ Bitcoin/Ethereum κ°€κ²© μμ§‘
- [x] D1 λ°μ΄ν„°λ² μ΄μ¤μ— κ°€κ²© λ°μ΄ν„° μ €μ¥

### μ°¨νΈ μƒμ„± λ° μ„λΉ™
- [x] μ• λ‹λ©”μ΄μ… SVG μ°¨νΈ μƒμ„± μ‹μ¤ν… (400x200px)
- [x] κ·ΈλΌλ””μ–ΈνΈ, λΌμ΄λΈ μΈλ””μΌ€μ΄ν„°, κ°€κ²© νΈλ λ“ ν¬ν•¨
- [x] R2 λ²„ν‚·μ— μ°¨νΈ νμΌ μ €μ¥
- [x] κ΄€λ¦¬μ λ€μ‹λ³΄λ“ (`/admin`)
- [x] μ°¨νΈ μƒμ„± API (`/api/generate-chart`)

### μ„λ² λ”© μ‹μ¤ν…
- [x] μ„λ² λ“ μ—”λ“ν¬μΈνΈ (`/embed/chart.webm`)
- [x] CORS ν—¤λ” λ° μΊμ‹ μ μ–΄ μ„¤μ •
- [x] μ»¤λ®¤λ‹ν‹° μ‚¬μ΄νΈ μ„λ² λ”©μ© μ½”λ“ μ κ³µ

## β ν•΄κ²° ν•„μ”ν• μ΄μ

### π¨ μ°μ„ μμ„ λ†’μ: λΈλΌμ°μ € λ΅λ”© λ¬Έμ 
- **λ¬Έμ **: μ„λ² λ“ URLμ΄ λ΅μ»¬μ—μ„λ” μ‘λ™ν•μ§€λ§ λΈλΌμ°μ €μ—μ„ μ§€μ†μ μΈ λ΅λ”© μƒνƒ
- **URL**: https://my-cloudflare-site.johnandgirl.workers.dev/embed/chart.webm
- **μ¶”μ • μ›μΈ**: HTTP ν—¤λ” λλ” MIME νƒ€μ… κµ¬μ„± λ¬Έμ 
- **μν–¥**: μ»¤λ®¤λ‹ν‹° μ‚¬μ΄νΈμ—μ„ μ°¨νΈ μ„λ² λ”© λ¶κ°€

## π“ ν”„λ΅μ νΈ κµ¬μ΅°

```
/src/
β”β”€β”€ index.js          # λ©”μΈ λΌμ°ν„° λ° κ΄€λ¦¬μ λ€μ‹λ³΄λ“
β”β”€β”€ cronPrices.js     # CoinGecko API λ°μ΄ν„° μμ§‘
β”β”€β”€ dataApi.js        # D1 λ°μ΄ν„°λ² μ΄μ¤ μΏΌλ¦¬ API
β”β”€β”€ generateWebM.js   # μ• λ‹λ©”μ΄μ… SVG μ°¨νΈ μƒμ„±
β”β”€β”€ serveMedia.js     # R2 λ―Έλ””μ–΄ νμΌ μ„λΉ™ (λ””λ²„κΉ… ν¬ν•¨)
β”β”€β”€ embedChart.js     # κ³ μ • μ„λ² λ“ URL ν•Έλ“¤λ¬
β””β”€β”€ utils.js          # μ ν‹Έλ¦¬ν‹° ν•¨μ

/migrations/
β””β”€β”€ 0001_create_prices_table.sql  # D1 λ°μ΄ν„°λ² μ΄μ¤ μ¤ν‚¤λ§

wrangler.toml         # Cloudflare μ„¤μ •
package.json          # μΆ…μ†μ„± (itty-router)
```

## π”§ μ£Όμ” API μ—”λ“ν¬μΈνΈ

### κ΄€λ¦¬μ κΈ°λ¥
- `GET /` - λ©”μΈ νμ΄μ§€
- `GET /admin` - κ΄€λ¦¬μ λ€μ‹λ³΄λ“
- `POST /api/generate-chart` - μλ™ μ°¨νΈ μƒμ„±

### λ°μ΄ν„° API
- `GET /api/prices` - μ €μ¥λ κ°€κ²© λ°μ΄ν„° μ΅°ν
- `GET /api/data-status` - λ°μ΄ν„°λ² μ΄μ¤ μƒνƒ ν™•μΈ

### μ„λ² λ”©
- `GET /embed/chart.webm` - μµμ‹  μ°¨νΈ μ„λ² λ“ (π¨ μ΄μ λ°μƒ μ¤‘)

### ν¬λ΅  μ‘μ—…
- λ§¤μ‹κ°„ μλ™ κ°€κ²© λ°μ΄ν„° μμ§‘ λ° μ°¨νΈ μ—…λ°μ΄νΈ

## π›  κ°λ° λ° λ°°ν¬

### λ΅μ»¬ κ°λ°
```bash
# ν”„λ΅μ νΈ ν΄λ”λ΅ μ΄λ™
cd /workspaces/my-cloudflare-site

# μΆ…μ†μ„± μ„¤μΉ
npm install

# λ΅μ»¬ κ°λ° μ„λ²„ μ‹¤ν–‰
npx wrangler dev

# D1 λ°μ΄ν„°λ² μ΄μ¤ λ§μ΄κ·Έλ μ΄μ…
npx wrangler d1 migrations apply crypto-prices-db
```

### λ°°ν¬
```bash
# Cloudflare Workersμ— λ°°ν¬
npx wrangler deploy
```

## π“ κΈ°μ  μ¤νƒ

- **Runtime**: Cloudflare Workers
- **Database**: Cloudflare D1 (SQLite)
- **Storage**: Cloudflare R2
- **Router**: itty-router
- **External API**: CoinGecko API
- **Chart Format**: μ• λ‹λ©”μ΄μ… SVG (WebM λ€μ‹  μ„±λ¥μƒ μ΄μ )

## π” λ””λ²„κΉ… μ •λ³΄

### ν„μ¬ μ°¨νΈ μƒμ„± νλ¦„
1. ν¬λ΅  μ‘μ—…μ΄ λ§¤μ‹κ°„ CoinGeckoμ—μ„ κ°€κ²© λ°μ΄ν„° μμ§‘
2. λ°μ΄ν„°λ¥Ό D1 λ°μ΄ν„°λ² μ΄μ¤μ— μ €μ¥
3. μ°¨νΈ μƒμ„± μ‹ μµκ·Ό 24μ‹κ°„ λ°μ΄ν„° μ΅°ν
4. SVG μ• λ‹λ©”μ΄μ… μ°¨νΈ μƒμ„± (400x200px)
5. R2 λ²„ν‚·μ— μ €μ¥ λ° μ„λ² λ“ URLλ΅ μ„λΉ™

### λ΅κ·Έ λ° λ¨λ‹ν„°λ§
- R2 μ €μ¥ λ° λ―Έλ””μ–΄ μ„λΉ™μ— μƒμ„Έν• λ΅κΉ… μ¶”κ°€λ¨
- κ΄€λ¦¬μ λ€μ‹λ³΄λ“μ—μ„ λ°μ΄ν„° μƒνƒ ν™•μΈ κ°€λ¥
- μλ™ μ°¨νΈ μƒμ„±μΌλ΅ ν…μ¤νΈ κ°€λ¥

## π― λ‹¤μ λ‹¨κ³„

1. **μ°μ„ **: λΈλΌμ°μ € λ΅λ”© μ΄μ ν•΄κ²°
   - HTTP ν—¤λ” κ²€ν† 
   - MIME νƒ€μ… ν™•μΈ
   - CORS μ„¤μ • μ κ²€

2. **κ°μ„ μ‚¬ν•­**:
   - λ‹¤μ¤‘ μ•”νΈν™”ν μ§€μ› ν™•μ¥
   - μ°¨νΈ μ»¤μ¤ν„°λ§μ΄μ§• μµμ…
   - μ„±λ¥ μµμ ν™”
   - μ—λ¬ μ²λ¦¬ κ°•ν™”

## π“ λ¬Έμ  ν•΄κ²°

λΈλΌμ°μ € λ΅λ”© μ΄μκ°€ ν•΄κ²°λλ©΄ λ‹¤μκ³Ό κ°™μ΄ μ‚¬μ© κ°€λ¥:

```html
<!-- μ»¤λ®¤λ‹ν‹° μ‚¬μ΄νΈ μ„λ² λ”© -->
<div style="width: 400px; height: 200px;">
  <object data="https://my-cloudflare-site.johnandgirl.workers.dev/embed/chart.webm" 
          type="image/svg+xml" 
          width="400" 
          height="200">
    μ°¨νΈλ¥Ό λ΅λ“ν•  μ μ—†μµλ‹λ‹¤.
  </object>
</div>
```

---
**λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2025λ…„ 5μ›” 28μΌ  
**μƒνƒ**: κ°λ° μ™„λ£, λΈλΌμ°μ € νΈν™μ„± μ΄μ ν•΄κ²° ν•„μ”
